<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Azure Speech Service (REST API ë°©ì‹) - í˜¸í†µ ìŠ¤íƒ€ì¼</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
            Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
            padding: 2em;
            line-height: 1.6;
            background-color: #f4f4f9;
            color: #333;
        }
        .container {
            max-width: 700px;
            margin: auto;
            background: white;
            padding: 2em;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        #text-to-read {
            padding: 1.5em;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #fafafa;
        }
        button {
            display: inline-block;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 1em;
            border-radius: 5px;
            border: none;
            background-color: #28a745;
            color: white;
            transition: background-color 0.2s;
        }
        button:hover {
            background-color: #218838;
        }
        button:disabled {
            background-color: #a0a0a0;
            cursor: not-allowed;
        }
        #status {
            margin-top: 1em;
            font-weight: 500;
            color: #555;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Azure Speech Service í…ìŠ¤íŠ¸ ì½ê¸° (í˜¸í†µ ìŠ¤íƒ€ì¼ ì ìš©)</h1>
        <p>SDK ì—†ì´ REST APIë¥¼ ì§ì ‘ í˜¸ì¶œí•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.</p>

        <div id="text-to-read">
            <p>ì‹ ì€ ìš©ê¸° ìˆëŠ” ìë¥¼ ë²„ë¦¬ì§€ ì•ŠëŠ”ë‹¤ê³ ? ì‹ ì´ ë„ ë³´ë©´ í•œìˆ¨ë¶€í„° ì‰´ ê±¸? </p>
        </div>

        <button id="speakButton">í…ìŠ¤íŠ¸ ì½ê¸° (REST API)</button>
        <div id="status">ë²„íŠ¼ì„ ëˆŒëŸ¬ ìŒì„± í•©ì„±ì„ ì‹œì‘í•˜ì„¸ìš”.</div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {

            const speakButton = document.getElementById('speakButton');
            const textToReadElement = document.getElementById('text-to-read');
            const statusDiv = document.getElementById('status');
            
            // ğŸš¨ ì—¬ê¸°ì— ìì‹ ì˜ Azure API í‚¤ì™€ ì§€ì—­ì„ ì…ë ¥í•˜ì„¸ìš”.
            const subscriptionKey = "CDMFmssz9uvlAiSVEeIpkygMToz8sa1I5TWrxj3k3kadPycA3wvZJQQJ99BIACNns7RXJ3w3AAAYACOGAZrv"; // ğŸ‘ˆ ì‹¤ì œ í‚¤ë¡œ ë³€ê²½í•˜ì„¸ìš”.
            const serviceRegion = "koreacentral"; // ğŸ‘ˆ ì‹¤ì œ ì§€ì—­ìœ¼ë¡œ ë³€ê²½í•˜ì„¸ìš”.

            // 1. ì¸ì¦ í† í°ì„ ìš”ì²­í•˜ëŠ” í•¨ìˆ˜
            async function getAuthenticationToken() {
                const tokenEndpoint = `https://${serviceRegion}.api.cognitive.microsoft.com/sts/v1.0/issueToken`;
                
                try {
                    const response = await fetch(tokenEndpoint, {
                        method: 'POST',
                        headers: {
                            'Ocp-Apim-Subscription-Key': subscriptionKey
                        }
                    });
                    if (!response.ok) {
                        throw new Error(`ì¸ì¦ ì„œë²„ ì˜¤ë¥˜: ${response.status} ${response.statusText}`);
                    }
                    return await response.text();
                } catch (error) {
                    console.error("ì¸ì¦ í† í° ìš”ì²­ ì‹¤íŒ¨:", error);
                    return null;
                }
            }

            // 2. í…ìŠ¤íŠ¸ë¥¼ ìŒì„±ìœ¼ë¡œ ë³€í™˜ ìš”ì²­í•˜ëŠ” ë©”ì¸ í•¨ìˆ˜
            async function synthesizeSpeech() {
                speakButton.disabled = true;
                statusDiv.textContent = "ì¸ì¦ í† í° ìš”ì²­ ì¤‘...";

                const token = await getAuthenticationToken();

                if (!token) {
                    statusDiv.textContent = "ì˜¤ë¥˜: ì¸ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. API í‚¤ì™€ ì§€ì—­ì„ í™•ì¸í•˜ì„¸ìš”.";
                    speakButton.disabled = false;
                    return;
                }

                statusDiv.textContent = "ìŒì„± í•©ì„± ìš”ì²­ ì¤‘...";

                const ttsEndpoint = `https://${serviceRegion}.tts.speech.microsoft.com/cognitiveservices/v1`;
                const text = textToReadElement.innerText;

                // --- [ë³€ê²½ ì§€ì ] ---
                // SSMLì— <prosody> íƒœê·¸ë¥¼ ì¶”ê°€í•˜ì—¬ ìŒì„± ìŠ¤íƒ€ì¼ ì¡°ì ˆ (í˜¸í†µì¹˜ëŠ” íš¨ê³¼)
                // rate: ë§í•˜ê¸° ì†ë„ (1.0ì´ ê¸°ë³¸ê°’, 1.1ì€ 10% ë¹ ë¥´ê²Œ)
                // pitch: ìŒë†’ì´ ('high'ë¡œ ì„¤ì •í•˜ì—¬ í†¤ì„ ë†’ì„)
                // volume: ìŒëŸ‰ ('+30.00%'ë¡œ ì„¤ì •í•˜ì—¬ ì†Œë¦¬ë¥¼ í‚¤ì›€)
                const ssml = `
                    <speak version='1.0' xml:lang='ko-KR'>
                        <voice name='ko-KR-InJoonNeural'>
                            <prosody rate="1.3" pitch="high" volume="+40.00%">
                                ${text}
                            </prosody>
                        </voice>
                    </speak>`;
                // --- [ë³€ê²½ ì™„ë£Œ] ---
                
                try {
                    const response = await fetch(ttsEndpoint, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/ssml+xml',
                            'X-Microsoft-OutputFormat': 'audio-24khz-48kbitrate-mono-mp3'
                        },
                        body: ssml
                    });

                    if (!response.ok) {
                        throw new Error(`ìŒì„± í•©ì„± ì„œë²„ ì˜¤ë¥˜: ${response.status} ${response.statusText}`);
                    }

                    // 3. ì‘ë‹µìœ¼ë¡œ ë°›ì€ ì˜¤ë””ì˜¤ ë°ì´í„° ì¬ìƒ
                    const audioBlob = await response.blob();
                    const audioUrl = URL.createObjectURL(audioBlob);
                    const audio = new Audio(audioUrl);
                    
                    audio.onended = () => {
                        statusDiv.textContent = "ìŒì„± ì¬ìƒì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.";
                        speakButton.disabled = false;
                        URL.revokeObjectURL(audioUrl);
                    };

                    statusDiv.textContent = "ìŒì„± ì¬ìƒ ì¤‘...";
                    audio.play();

                } catch (error) {
                    console.error("ìŒì„± í•©ì„± ì‹¤íŒ¨:", error);
                    statusDiv.textContent = `ì˜¤ë¥˜: ${error.message}`;
                    speakButton.disabled = false;
                }
            }

            speakButton.addEventListener('click', synthesizeSpeech);
        });
    </script>

</body>
</html>