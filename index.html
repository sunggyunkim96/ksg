<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Azure Speech Service (REST API 방식) - 호통 스타일</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
            Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
            padding: 2em;
            line-height: 1.6;
            background-color: #f4f4f9;
            color: #333;
        }
        .container {
            max-width: 700px;
            margin: auto;
            background: white;
            padding: 2em;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        #text-to-read {
            padding: 1.5em;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #fafafa;
        }
        button {
            display: inline-block;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 1em;
            border-radius: 5px;
            border: none;
            background-color: #28a745;
            color: white;
            transition: background-color 0.2s;
        }
        button:hover {
            background-color: #218838;
        }
        button:disabled {
            background-color: #a0a0a0;
            cursor: not-allowed;
        }
        #status {
            margin-top: 1em;
            font-weight: 500;
            color: #555;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Azure Speech Service 텍스트 읽기 (호통 스타일 적용)</h1>
        <p>SDK 없이 REST API를 직접 호출하는 방식입니다.</p>

        <div id="text-to-read">
            <p>신은 용기 있는 자를 버리지 않는다고? 신이 널 보면 한숨부터 쉴 걸? </p>
        </div>

        <button id="speakButton">텍스트 읽기 (REST API)</button>
        <div id="status">버튼을 눌러 음성 합성을 시작하세요.</div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {

            const speakButton = document.getElementById('speakButton');
            const textToReadElement = document.getElementById('text-to-read');
            const statusDiv = document.getElementById('status');
            
            // 🚨 여기에 자신의 Azure API 키와 지역을 입력하세요.
            const subscriptionKey = "CDMFmssz9uvlAiSVEeIpkygMToz8sa1I5TWrxj3k3kadPycA3wvZJQQJ99BIACNns7RXJ3w3AAAYACOGAZrv"; // 👈 실제 키로 변경하세요.
            const serviceRegion = "koreacentral"; // 👈 실제 지역으로 변경하세요.

            // 1. 인증 토큰을 요청하는 함수
            async function getAuthenticationToken() {
                const tokenEndpoint = `https://${serviceRegion}.api.cognitive.microsoft.com/sts/v1.0/issueToken`;
                
                try {
                    const response = await fetch(tokenEndpoint, {
                        method: 'POST',
                        headers: {
                            'Ocp-Apim-Subscription-Key': subscriptionKey
                        }
                    });
                    if (!response.ok) {
                        throw new Error(`인증 서버 오류: ${response.status} ${response.statusText}`);
                    }
                    return await response.text();
                } catch (error) {
                    console.error("인증 토큰 요청 실패:", error);
                    return null;
                }
            }

            // 2. 텍스트를 음성으로 변환 요청하는 메인 함수
            async function synthesizeSpeech() {
                speakButton.disabled = true;
                statusDiv.textContent = "인증 토큰 요청 중...";

                const token = await getAuthenticationToken();

                if (!token) {
                    statusDiv.textContent = "오류: 인증에 실패했습니다. API 키와 지역을 확인하세요.";
                    speakButton.disabled = false;
                    return;
                }

                statusDiv.textContent = "음성 합성 요청 중...";

                const ttsEndpoint = `https://${serviceRegion}.tts.speech.microsoft.com/cognitiveservices/v1`;
                const text = textToReadElement.innerText;

                // --- [변경 지점] ---
                // SSML에 <prosody> 태그를 추가하여 음성 스타일 조절 (호통치는 효과)
                // rate: 말하기 속도 (1.0이 기본값, 1.1은 10% 빠르게)
                // pitch: 음높이 ('high'로 설정하여 톤을 높임)
                // volume: 음량 ('+30.00%'로 설정하여 소리를 키움)
                const ssml = `
                    <speak version='1.0' xml:lang='ko-KR'>
                        <voice name='ko-KR-InJoonNeural'>
                            <prosody rate="1.3" pitch="high" volume="+40.00%">
                                ${text}
                            </prosody>
                        </voice>
                    </speak>`;
                // --- [변경 완료] ---
                
                try {
                    const response = await fetch(ttsEndpoint, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/ssml+xml',
                            'X-Microsoft-OutputFormat': 'audio-24khz-48kbitrate-mono-mp3'
                        },
                        body: ssml
                    });

                    if (!response.ok) {
                        throw new Error(`음성 합성 서버 오류: ${response.status} ${response.statusText}`);
                    }

                    // 3. 응답으로 받은 오디오 데이터 재생
                    const audioBlob = await response.blob();
                    const audioUrl = URL.createObjectURL(audioBlob);
                    const audio = new Audio(audioUrl);
                    
                    audio.onended = () => {
                        statusDiv.textContent = "음성 재생이 완료되었습니다.";
                        speakButton.disabled = false;
                        URL.revokeObjectURL(audioUrl);
                    };

                    statusDiv.textContent = "음성 재생 중...";
                    audio.play();

                } catch (error) {
                    console.error("음성 합성 실패:", error);
                    statusDiv.textContent = `오류: ${error.message}`;
                    speakButton.disabled = false;
                }
            }

            speakButton.addEventListener('click', synthesizeSpeech);
        });
    </script>

</body>
</html>